# 前端测试指南

## 📋 目录

1. [前后端对接完成情况](#前后端对接完成情况)
2. [前端测试接口的常用方式](#前端测试接口的常用方式)
3. [使用内置的API设置页面](#使用内置的api设置页面)
4. [快速开始](#快速开始)
5. [常见问题](#常见问题)

---

## ✅ 前后端对接完成情况

### 已完成的功能模块

#### 1. **API 服务层** (`src/api/roomApi.ts`)
- ✅ 创建了统一的 API 服务封装
- ✅ 支持所有后端 API 接口（创建/加入/退出/解散房间等）
- ✅ 统一的错误处理机制
- ✅ 支持动态修改 API 地址

#### 2. **环境配置** (`src/config/api.ts`)
- ✅ 支持通过 `.env` 文件配置后端地址
- ✅ 支持通过 localStorage 动态修改 API 地址
- ✅ 默认地址：`http://localhost:3000/api`

#### 3. **页面对接**
- ✅ **HomeView** - 首页，添加了 API 设置入口
- ✅ **CreateRoomView** - 创建房间页面，完整对接后端 API
- ✅ **JoinView** - 加入房间页面，支持列表加载和密码验证
- ✅ **RoomView** - 房间详情页面，支持获取房间信息和退出/解散
- ✅ **SettingsView** - 新增 API 设置和测试页面

---

## 🧪 前端测试接口的常用方式

### 方式 1：使用浏览器开发者工具 (推荐⭐)

**优点**：无需额外工具，直接在浏览器中查看网络请求和响应

**步骤**：
1. 打开浏览器开发者工具（F12 或右键 → 检查）
2. 切换到 **Network**（网络）标签
3. 执行前端操作（如创建房间、加入房间）
4. 查看请求和响应详情

**查看内容**：
- 请求 URL
- 请求方法（GET/POST/DELETE/PATCH）
- 请求头和请求体
- 响应状态码
- 响应数据

![Network Tab Example](https://via.placeholder.com/800x400?text=Network+Tab)

---

### 方式 2：使用项目内置的 API 设置页面 (最方便⭐⭐⭐)

项目已内置 API 测试页面，提供可视化的接口测试功能。

**访问路径**：`http://localhost:5173/settings`

**功能**：
- 修改后端 API 地址
- 测试连接状态
- 一键测试常用接口（获取统计、房间列表等）
- 查看请求和响应的 JSON 数据

**使用方法**：
1. 启动前端项目：`npm run dev`
2. 访问首页，点击底部"⚙️ API设置"按钮
3. 在设置页面配置后端地址
4. 点击"点击测试"按钮测试接口
5. 查看返回的 JSON 结果

---

### 方式 3：使用 Postman / Insomnia

**优点**：专业的 API 测试工具，功能强大

**步骤**：
1. 下载并安装 [Postman](https://www.postman.com/) 或 [Insomnia](https://insomnia.rest/)
2. 创建新请求
3. 配置请求方法、URL、Header、Body
4. 发送请求并查看响应

**示例 - 创建房间**：
```
POST http://localhost:3000/api/rooms
Content-Type: application/json

{
  "name": "测试房间",
  "capacity": 10,
  "password": "123456",
  "announcement": "欢迎来到测试房间",
  "creatorNickname": "测试用户"
}
```

---

### 方式 4：使用 curl 命令

**优点**：命令行工具，快速测试

**示例**：
```bash
# 获取房间列表
curl http://localhost:3000/api/rooms

# 创建房间
curl -X POST http://localhost:3000/api/rooms \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试房间",
    "capacity": 10,
    "creatorNickname": "测试用户"
  }'

# 获取房间详情
curl http://localhost:3000/api/rooms/123456
```

---

### 方式 5：使用 VS Code 插件 REST Client

**优点**：在 VS Code 中直接测试，无需切换工具

**步骤**：
1. 安装 VS Code 插件：[REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client)
2. 创建 `.http` 或 `.rest` 文件
3. 编写请求，点击"Send Request"

**示例文件** (`test-api.http`)：
```http
### 获取房间列表
GET http://localhost:3000/api/rooms

### 创建房间
POST http://localhost:3000/api/rooms
Content-Type: application/json

{
  "name": "测试房间",
  "capacity": 10,
  "creatorNickname": "测试用户"
}

### 获取房间详情
GET http://localhost:3000/api/rooms/123456
```

---

## 🎯 使用内置的API设置页面

### 1. 访问设置页面

启动项目后，访问：
- 首页 → 点击底部"⚙️ API设置"
- 或直接访问：`http://localhost:5173/settings`

### 2. 配置后端地址

在"后端 API 地址"输入框中输入：
```
http://localhost:3000/api
```

或者你的后端实际地址，然后点击"保存设置"。

### 3. 测试接口

设置页面提供了两个快速测试按钮：
- **获取房间统计** - 测试 `GET /api/rooms/stats`
- **获取房间列表** - 测试 `GET /api/rooms`

点击按钮后，会在下方显示请求结果的 JSON 数据。

### 4. 优势

✅ **无需安装额外工具**  
✅ **可视化界面，操作简单**  
✅ **实时查看请求和响应**  
✅ **动态切换后端地址**  
✅ **内置错误提示**

---

## 🚀 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置环境变量（可选）

复制 `.env.example` 为 `.env`：
```bash
cp .env.example .env
```

编辑 `.env` 文件：
```env
VITE_API_URL=http://localhost:3000/api
```

### 3. 启动项目

```bash
npm run dev
```

### 4. 访问首页

打开浏览器访问：`http://localhost:5173`

### 5. 测试流程

#### 场景 1：测试创建房间
1. 点击"创建观影室"
2. 填写房间信息（昵称、房间名称、公告等）
3. 点击"立即创建"
4. 打开 Network 标签查看请求：`POST /api/rooms`
5. 如果成功，会跳转到房间页面

#### 场景 2：测试加入房间
1. 点击"加入房间"
2. 输入昵称
3. 点击房间列表中的某个房间
4. 查看 Network 标签中的请求：`GET /api/rooms` 和 `POST /api/rooms/:id/join`

#### 场景 3：测试 API 设置页面
1. 首页 → 点击"⚙️ API设置"
2. 修改后端地址（如果需要）
3. 点击"获取房间统计"或"获取房间列表"
4. 查看返回的 JSON 数据

---

## ❓ 常见问题

### Q1: 需要在前端新增输入框填写后端地址吗？

**答：已经实现了！** 项目已经内置了一个专门的 **API 设置页面** (`/settings`)，你可以：
- 在首页点击"⚙️ API设置"进入
- 动态修改后端 API 地址
- 实时测试接口连接状态
- 查看请求和响应数据

这个页面会将设置保存到 `localStorage`，刷新页面后依然有效。

---

### Q2: 如何确认前后端是否连通？

**方法 1：使用设置页面**
1. 访问 `/settings`
2. 点击"获取房间统计"按钮
3. 如果成功，会显示统计数据的 JSON

**方法 2：查看浏览器控制台**
1. 打开开发者工具 Console 标签
2. 执行任何操作（如加入房间）
3. 查看是否有报错信息

**方法 3：查看 Network 标签**
1. 打开开发者工具 Network 标签
2. 执行操作
3. 查看请求状态码（200 表示成功）

---

### Q3: 后端地址写错了怎么办？

访问 `/settings` 页面，重新输入正确的地址并保存即可。

---

### Q4: 如何查看详细的错误信息？

1. **浏览器控制台** - 打开 Console 标签，所有 API 错误都会在这里显示
2. **Network 标签** - 查看具体请求的 Response 内容
3. **前端界面** - 已添加错误提示框，会显示后端返回的错误消息

---

### Q5: 如何在不同环境切换后端地址？

**方法 1：使用设置页面**（推荐用于开发测试）
- 访问 `/settings` 动态修改

**方法 2：使用环境变量**（推荐用于部署）
- 修改 `.env` 文件中的 `VITE_API_URL`
- 重启项目

**方法 3：直接修改 localStorage**
```javascript
localStorage.setItem('api_url', 'http://your-backend-url/api')
```

---

## 📝 API 列表

以下是已对接的所有 API：

| 功能 | 方法 | 路径 | 页面 |
|------|------|------|------|
| 创建房间 | POST | `/api/rooms` | CreateRoomView |
| 获取房间列表 | GET | `/api/rooms` | JoinView |
| 获取房间详情 | GET | `/api/rooms/:id` | RoomView |
| 加入房间 | POST | `/api/rooms/:id/join` | JoinView |
| 退出房间 | POST | `/api/rooms/:id/leave` | RoomView |
| 解散房间 | DELETE | `/api/rooms/:id` | RoomView |
| 更新房间 | PATCH | `/api/rooms/:id` | RoomView |
| 验证密码 | POST | `/api/rooms/:id/verify-password` | JoinView |
| 获取统计 | GET | `/api/rooms/stats` | SettingsView |

---

## 🎉 总结

**推荐的测试方式排序**：

1. ⭐⭐⭐ **项目内置的 API 设置页面** - 最方便，无需额外工具
2. ⭐⭐ **浏览器开发者工具** - 最直观，实时查看所有请求
3. ⭐ **Postman/Insomnia** - 功能最强大，适合深度测试
4. **curl 命令** - 快速简单，适合命令行爱好者
5. **REST Client 插件** - VS Code 内测试，适合开发流程

**是否需要新增输入框**：
- ✅ **已实现** - 项目已包含完整的 API 设置页面 (`/settings`)
- ✅ **动态修改** - 支持运行时修改后端地址
- ✅ **可视化测试** - 内置接口测试功能
- ✅ **持久化存储** - 配置保存在 localStorage

---

## 📞 技术支持

如有问题，请检查：
1. 后端服务是否正常运行（`http://localhost:3000`）
2. 前端服务是否正常运行（`http://localhost:5173`）
3. API 地址配置是否正确
4. 浏览器控制台是否有报错信息

祝测试顺利！🎬
